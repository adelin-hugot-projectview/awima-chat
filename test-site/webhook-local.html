<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thierry Chat Webhook - Test Local</title>
</head>
<body>
    <script>
        // Version locale simplifi√©e pour les tests
        class LocalWebhookHandler {
            constructor() {
                this.setupLocalTesting();
            }

            setupLocalTesting() {
                // R√©ponses pr√©d√©finies pour les tests locaux
                this.responses = {
                    "salut": "Salut ! üëã Je suis Thierry, ton assistant pour prendre rendez-vous avec Awima. Comment √ßa va ?",
                    "bonjour": "Bonjour ! Comment puis-je t'aider √† organiser un rendez-vous avec Awima aujourd'hui ?",
                    "rdv": "Parfait ! Pour prendre rendez-vous avec Awima, j'ai besoin de quelques infos. Quel type de consultation t'int√©resse ?",
                    "rendez-vous": "Excellent ! Awima propose plusieurs types de consultations :\n‚Ä¢ Coaching professionnel\n‚Ä¢ Conseil strat√©gique\n‚Ä¢ Consultation personnalis√©e\n\nLequel t'int√©resse ?",
                    "coaching": "Super choix ! Le coaching professionnel avec Awima dure g√©n√©ralement 1h. Es-tu disponible cette semaine ou pr√©f√®res-tu la semaine prochaine ?",
                    "conseil": "Parfait ! Pour le conseil strat√©gique, Awima propose des cr√©neaux de 90 minutes. Quand serais-tu disponible ?",
                    "consultation": "Excellente id√©e ! Pour une consultation personnalis√©e, nous pouvons pr√©voir entre 45min et 1h30. Quelle dur√©e pr√©f√®res-tu ?",
                    "horaire": "Awima est g√©n√©ralement disponible :\n‚Ä¢ Lundi au vendredi : 9h-18h\n‚Ä¢ Samedi matin : 9h-12h\n\nQuel cr√©neau te conviendrait le mieux ?",
                    "disponible": "Voici les cr√©neaux disponibles cette semaine :\n‚Ä¢ Mardi 14h-15h\n‚Ä¢ Mercredi 10h-11h\n‚Ä¢ Jeudi 16h-17h\n‚Ä¢ Vendredi 9h-10h\n\nLequel te convient ?",
                    "prix": "Les tarifs d'Awima sont :\n‚Ä¢ Consultation (1h) : 80‚Ç¨\n‚Ä¢ Coaching (1h) : 100‚Ç¨\n‚Ä¢ Conseil strat√©gique (90min) : 150‚Ç¨\n\nTous les prix incluent le suivi personnalis√© !",
                    "tarif": "Les tarifs d'Awima sont :\n‚Ä¢ Consultation (1h) : 80‚Ç¨\n‚Ä¢ Coaching (1h) : 100‚Ç¨\n‚Ä¢ Conseil strat√©gique (90min) : 150‚Ç¨\n\nTous les prix incluent le suivi personnalis√© !"
                };

                this.defaultResponse = "Je comprends ! Peux-tu me donner plus de d√©tails ? Je suis l√† pour t'aider √† organiser ton rendez-vous avec Awima. Tu peux me parler de :\n‚Ä¢ Le type de consultation qui t'int√©resse\n‚Ä¢ Tes disponibilit√©s\n‚Ä¢ Tes questions sur les services";

                console.log('ü§ñ Webhook local Thierry initialis√© - Mode TEST');
            }

            async processMessage(payload) {
                const { chatInput } = payload;
                const lowerMessage = chatInput.toLowerCase();

                console.log('üí¨ Message re√ßu:', chatInput);

                // Simuler un d√©lai de traitement
                await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));

                // Recherche de mots-cl√©s dans le message
                for (const [keyword, response] of Object.entries(this.responses)) {
                    if (lowerMessage.includes(keyword)) {
                        console.log('‚úÖ R√©ponse trouv√©e pour:', keyword);
                        return { output: response };
                    }
                }

                // R√©ponse par d√©faut
                console.log('üîç Utilisation de la r√©ponse par d√©faut');
                return { output: this.defaultResponse };
            }
        }

        // Gestionnaire global pour les appels externes
        window.ThierryWebhook = {
            processMessage: async (payload) => {
                const handler = new LocalWebhookHandler();
                return await handler.processMessage(payload);
            }
        };

        console.log('üöÄ Webhook local Thierry pr√™t !');
    </script>

    <!-- Interface de test -->
    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px;">
        <h2>üß™ Test Local - Webhook Thierry</h2>
        <p>Interface de test pour le chatbot en mode local</p>
        
        <div style="margin: 20px 0;">
            <label for="testMessage">Message de test:</label><br>
            <textarea id="testMessage" rows="3" style="width: 100%; margin: 5px 0; padding: 10px;">Salut, je veux prendre un rdv</textarea>
        </div>
        
        <button onclick="testLocalWebhook()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
            Tester la R√©ponse
        </button>
        
        <div id="testResult" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; display: none;">
            <h4>R√©ponse de Thierry:</h4>
            <div id="testOutput" style="background: white; padding: 15px; border-radius: 5px; border-left: 4px solid #667eea;"></div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border-radius: 10px;">
            <h3>üí° Mots-cl√©s de test</h3>
            <p>Essayez ces messages pour tester les r√©ponses :</p>
            <ul>
                <li><code>salut</code> ou <code>bonjour</code></li>
                <li><code>rdv</code> ou <code>rendez-vous</code></li>
                <li><code>coaching</code> ou <code>conseil</code></li>
                <li><code>horaire</code> ou <code>disponible</code></li>
                <li><code>prix</code> ou <code>tarif</code></li>
            </ul>
        </div>

        <script>
            async function testLocalWebhook() {
                const message = document.getElementById('testMessage').value;
                const resultDiv = document.getElementById('testResult');
                const outputDiv = document.getElementById('testOutput');
                
                if (!message.trim()) {
                    alert('Veuillez saisir un message de test');
                    return;
                }
                
                try {
                    outputDiv.innerHTML = '<p style="color: #666; font-style: italic;">Thierry r√©fl√©chit...</p>';
                    resultDiv.style.display = 'block';
                    
                    const response = await window.ThierryWebhook.processMessage({
                        chatInput: message,
                        conversationId: 'test_local_' + Date.now(),
                        timestamp: new Date().toISOString()
                    });
                    
                    outputDiv.innerHTML = response.output.replace(/\n/g, '<br>');
                    
                } catch (error) {
                    outputDiv.innerHTML = '<p style="color: red;">‚ùå Erreur: ' + error.message + '</p>';
                }
            }
            
            // Test automatique au chargement
            document.addEventListener('DOMContentLoaded', function() {
                console.log('üéØ Page de test charg√©e - Pr√™t pour les tests !');
            });
        </script>
    </div>
</body>
</html>